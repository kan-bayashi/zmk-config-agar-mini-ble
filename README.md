# zmk-config for Agar Mini BLE

ZMK firmware configuration for the Agar Mini BLE 40% keyboard.

## Keymap

```
┌────────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬────────┐
│   0    │   1  │   2  │   3  │   4  │   5  │   6  │   7  │   8  │   9  │  10  │  11  │   12   │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┴────────┤
│  13    │  14  │  15  │  16  │  17  │  18  │  19  │  20  │  21  │  22  │  23  │      24       │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼───────────────┤
│  25    │  26  │  27  │  28  │  29  │  30  │  31  │  32  │  33  │  34  │  35  │      36       │
└────────┼──────┼──────┼──────┴──────┴──────┼──────┴──────┴──────┼──────┼──────┼───────────────┘
         │  37  │  38  │         39         │         40         │  41  │  42  │
         └──────┴──────┴────────────────────┴────────────────────┴──────┴──────┘
```

### Layer 0: Default

```
┌────────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬────────┐
│  Tab   │   Q  │   W  │   E  │   R  │   T  │   Y  │   U  │   I  │   O  │   P  │   \  │  Bksp  │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┴────────┤
│  Ctrl  │   A  │   S  │   D  │   F  │   G  │   H  │   J  │   K  │   L  │   ;  │     Enter     │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼───────────────┤
│ Shift  │   Z  │   X  │   C  │   V  │   B  │   N  │   M  │   ,  │   .  │   /  │      L3       │
└────────┼──────┼──────┼──────┴──────┴──────┼──────┴──────┴──────┼──────┼──────┼───────────────┘
         │  Alt │ GUI  │    GUI   Space     │   L1   Space       │L2+GUI│ Alt  │
         └──────┴──────┴────────────────────┴────────────────────┴──────┴──────┘
```

### Layer 1: Numbers & Symbols

```
┌────────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬────────┐
│ Esc/`  │   1  │   2  │   3  │   4  │   5  │   6  │   7  │   8  │   9  │   0  │      │        │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┴────────┤
│        │      │      │ LClk │  M↑  │ RClk │      │   -  │   =  │   [  │   ]  │       '       │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼───────────────┤
│        │      │      │  M←  │  M↓  │  M→  │      │      │      │      │      │               │
└────────┼──────┼──────┼──────┴──────┴──────┼──────┴──────┴──────┼──────┼──────┼───────────────┘
         │      │      │                    │         ▼          │      │      │
         └──────┴──────┴────────────────────┴────────────────────┴──────┴──────┘
```

### Layer 2: Navigation & Device

```
┌────────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬────────┐
│  Caps  │PrtSc │ PgUp │ Home │  F2  │ Scr↑ │      │      │      │      │      │      │        │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┴────────┤
│        │  Del │ PgDn │  End │  F5  │ Scr↓ │  USB │  BT1 │  BT2 │  BT3 │      │               │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼───────────────┤
│        │Pause │ScrLk │  F4  │Paste │      │      │      │      │      │      │               │
└────────┼──────┼──────┼──────┴──────┴──────┼──────┴──────┴──────┼──────┼──────┼───────────────┘
         │      │      │     Show Battery   │       BT Status    │  ▼   │      │
         └──────┴──────┴────────────────────┴────────────────────┴──────┴──────┘
```

### Layer 3: Media & System

```
┌────────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬────────┐
│ Reset  │      │      │      │      │      │      │      │      │      │   ↑  │      │        │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┴────────┤
│        │      │      │      │      │      │      │      │      │   ←  │   →  │     Play      │
├────────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼───────────────┤
│        │      │      │      │      │      │      │      │      │   ↓  │ Vol+ │       ▼       │
└────────┼──────┼──────┼──────┴──────┴──────┼──────┴──────┴──────┼──────┼──────┼───────────────┘
         │      │      │      SoftOff       │        Lock        │ Mute │ Vol- │
         └──────┴──────┴────────────────────┴────────────────────┴──────┴──────┘
```

## Special Features

- **BT1/BT2/BT3**: Tap to switch, hold 3s to clear pairing
- **Reset**: Tap for system reset, hold 2s for bootloader
- **SoftOff**: Hold 2s to power off (red LED feedback)
- **Lock Layer**: Hold 2s to enter lock mode (yellow LED), combo to exit (green LED)
- **USB Auto-Switch**: Automatically switches to USB when connected (white LED)
- **Wakeup (Soft off)**: S key wakes the board (configured in `config/boards/shields/klink_kbd/common.overlay`)

## Wakeup Notes (Soft off)

- Wakeup source is the S key (row 1, col 2) via `wakeup_scan` in `config/boards/shields/klink_kbd/common.overlay`.
- If wakeup feels unresponsive, hold S for ~0.5-1s or tap A/S/D a few times to create a reliable edge.

## LED Indicators

| Event | Color |
|-------|-------|
| BT1 connected | Yellow |
| BT2 connected | Cyan |
| BT3 connected | Magenta |
| USB connected | White |
| Lock layer enter | Yellow |
| Lock layer exit | Green |
| Soft off | Red |
| Battery (80%+) | Green |
| Battery (50-80%) | Cyan |
| Battery (20-50%) | Yellow |
| Battery (<20%) | Red |

## Build

Firmware is built via GitHub Actions. Push changes and download from Actions artifacts.
